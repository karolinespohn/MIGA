# Introduction
Welcome to MIGA.
This app includes a scoreboard and badges and its aim is making imlab more fun and engaging.
I implemented a scoreboard, dashboard with awards and a performance graph. 
# How to run
- create venv
- run `pip install -r requirements.txt`
- run `python manage.py makemigrations miga`
- run `python manage.py`
- create .env file with DJANGO_SECRET_KEY and `DEBUG=True`
- run `python manage.py runserver`

If you want to test pushing, you need to do a few changes in the CI pipeline and you will either need to deploy the app, or use ngrok (as I did).

# How to use next semester
## Step 1: Set up GitLab
### Architecture
Create new group on GitLab.
My structure looks like this: 
    Imlab NG
     |__ imlab
     |    |__ student repos
     |__ runner
     |__ tpcc_5w
You can change the architecture, but remember to also change paths in the CI pipeline (you will have to do this either way).
### TPCC file access
Go to the repo with the TPCC files. This is necessary for the benchmarks in week 1. Create an access token like so: 
- Go to Einstellungen > Access tokens
- Neuer Token Hinzufuegen
- Choose the following settings: name: tpcc-data-access, Geltungsbereiche: read_repository, Gueltig bis: Abgabedatum, Rolle: Reporter

Go to the group with the student repos and add a token called `BENCHMARK_ACCESS_TOKEN`. 
If you want to change the name, you will have to change this line in the `.gitlab-ci.yml`: 
`git clone https://oauth2:$BENCHMARK_ACCESS_TOKEN@gitlab.db.in.tum.de/imlab-ng/tpcc_5w.git tpccFiles`
You will have to update the link regardless, but we will get to that soon. 
### Student API tokens
To uniquely identify a student and to give them access to the API, tokens need to be created for each student. 
After accounts were created for each student, tokens can be generated by running `management/commands/generate_tokens.py`.
In their repos, students should go to Einstellungen > CI/CD > Variablen and create a variable called `SCOREBOARD_ACCESS_TOKEN`.

## Step 2: CI Pipeline
You can find my CI specification in `Imlab NG/imlab/tasks.cpp/.gitlab-ci.yml` 
Here's whats happening in the CI Pipeline: 
Git LFS is installed. This is necessary for dealing with the large tpcc files. The repo is cloned and the content is pulled with LFS. 
The project is built and the benchmarks are run. The output of the benchmarks is sent to the scoreboard.
You will need to change the following things: 
- Change this to use the proper link: `git clone https://oauth2:$BENCHMARK_ACCESS_TOKEN@gitlab.db.in.tum.de/imlab-ng/tpcc_5w.git tpccFiles`
- For Rust repos, change "cpp" to "rust" here: ` -d "{\"raw_data\": $(cat benchmark_results.json), \"language\": \"cpp\"}" \`
- Change this address to use your domain `https://vital-whippet-ideally.ngrok-free.app/api/benchmark-results/`

## Step 3: Benchmark code
- You can find my benchmarks in `Imlab NG/imlab/tasks.cpp/benchmark/benchmark.cpp` 
- I marked, which benchmark is for which week. The names of the benchmark functions are BM_W<number>. You can change them to BM_W<number>_description. If you want to change them to a different name, you will need to make some changes to MIGA as well. 
- Most of the benchmarks are the same as the tests. Some are changed. 
- I also made some changes to the CMAKE which have to be.

## Step 4: MIGA
Create a .env file with the DJANGO secret key. 
### Admin options: 
You have the following options in the admin panel: 
You can find all the auth-tokens for the students.
You can add end-dates to the assignments. This helps with awards and with stopping changing benchmarks after the deadline is over. 
You can add, change, remove,... awards. 
You can see the performances. 
If you go to users, you can select a number of users, choose the "Give Demonstration Dodo badge to seleced students" after presentations. 

### Dashboard
The dashboard is pretty straightforward. You can see the performance graph, choose to switch language (in particular if a student actually switches language and wants to see old performances), see your best rank so far, best rank overall, total score and all badges you earned. 
### Scoreboard
The scoreboard is also straightforward. You can see all users and their awards. 
### Profile
You can choose to hide your username


